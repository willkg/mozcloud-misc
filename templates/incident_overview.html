<html>
<head>
  <title>{{ title }}</title>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    background: #ffffff;
    color: #1f2937;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 14px;
    line-height: 1.45;
  }

  /* Constrain width for readability in email clients */
  body {
    padding: 20px;
    max-width: 860px;
  }

  /* Headings */
  h1 {
    font-size: 16px;
    margin: 18px 0 10px;
    color: #111827;
    letter-spacing: 0.2px;
    border-top: 1px solid #e5e7eb;
    padding-top: 14px;
  }
  h1:first-of-type {
    border-top: 0;
    padding-top: 0;
    margin-top: 0;
  }

  /* Paragraphs / meta */
  p {
    margin: 8px 0 14px;
    color: #1f2937;
  }
  code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size: 12px;
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    padding: 1px 6px;
    border-radius: 6px;
  }

  a {
    color: #0b5fff;
    text-decoration: none;
  }
  a:hover { text-decoration: underline; }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  /* Make the first table (your Summary severity counts) compact and “badge-like” */
  table.severity_breakdown {
    width: auto;
    max-width: 520px;
  }

  td {
    padding: 10px;
    border: 1px solid #e5e7eb;   /* ← THIS is what Gmail respects */
  }

  /* Zebra striping for long incident tables */
  tr.row-even td { background-color: #f5f5f5; }

  /* Make incident tables easier to scan:
     - keep ID/status compact
     - allow description to breathe */
  /* Applies to your incident tables because they only have TDs (no TH row). */
  table.incidents td:nth-child(1), /* IIM-### */
  table.incidents td:nth-child(2), /* S# */
  table.incidents td:nth-child(3)  /* status */
  {
    white-space: nowrap;
  }

  table.incidents td:nth-child(4) {   /* summary */
    width: 100%;
    color: #1f2937;
  }

  span.status {
    font-weight: 700;
    font-size: 12px;
    line-height: 1;
    display: inline-block;          /* allows pill shape */
    vertical-align: middle;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid transparent;
    white-space: nowrap;
  }
  span.status.status-Detected {
    background: #FEE2E2;            /* light red */
    color: #991B1B;                 /* dark red */
    border-color: #FCA5A5;
  }
  span.status.status-InProgress {
    background: #FEE2E2;            /* light red */
    color: #991B1B;                 /* dark red */
    border-color: #FCA5A5;
  }
  span.status.status-Mitigated {
    background: #FEF3C7;            /* light amber */
    color: #92400E;                 /* dark amber */
    border-color: #FCD34D;
  }
  span.status.status-Resolved {
    background: #E2FeE2;            /* light green */
    color: #1B991B;                 /* dark green */
    border-color: #A5FCA5;
  }

  span.sev {
    font-weight: 700;
    font-size: 12px;
    line-height: 1;
    display: inline-block;          /* allows pill shape */
    padding: 4px 8px;
    vertical-align: middle;
    border-radius: 999px;
    border: 1px solid transparent;
    white-space: nowrap;
  }
  span.sev.sev-S1 {
    background: #FEE2E2;            /* light red */
    color: #991B1B;                 /* dark red */
    border-color: #FCA5A5;
  }
  span.sev.sev-S2 {
    background: #FFDEAD;            /* light orange */
    color: #9A3412;                 /* dark orange */
    border-color: #FDBA74;
  }
  span.sev.sev-S3 {
    background: #FEF3C7;            /* light amber */
    color: #92400E;                 /* dark amber */
    border-color: #FCD34D;
  }
  span.sev.sev-S4 {
    background: #E0E7FF;            /* light indigo */
    color: #3730A3;                 /* dark indigo */
    border-color: #A5B4FC;
  }

  /* Footer text */
  body > p:last-of-type {
    color: #6b7280;
    font-size: 12px;
    margin-top: 16px;
  }
  </style>
</head>
<body>
  <p>Weekly incident overview from {{ last_friday }} to {{ this_friday }}.
  <h1>Summary</h1>
  <p>
    {% if num_incidents == 1 %}
      There was {{ num_incidents }} incident in the last week.
    {% else %}
      There were {{ num_incidents }} incidents in the last week.
    {% endif %}
  </p>
  <table class="severity_breakdown">
    <tr>
      <td><span class="sev sev-S1">S1</span></td>
      <td>{{ num_s1_incidents }}</td>
      <td><span class="sev sev-S2">S2</span></td>
      <td>{{ num_s2_incidents }}</td>
      <td><span class="sev sev-S3">S3</span></td>
      <td>{{ num_s3_incidents }}</td>
      <td><span class="sev sev-S4">S4</span></td>
      <td>{{ num_s4_incidents }}</td>
    </tr>
  </table>
      
  <h1>New incidents declared in the last week ({{ new_incidents | length }})</h1>
  {% if new_incidents %}
    <table class="incidents">
      <tr>
        <th>Jira</th>
        <th>Severity</th>
        <th>Status</th>
        <th>Summary</th>
      </tr>
      {% for item in new_incidents | sort(attribute="severity") %}
        <tr class="row-{{ loop.cycle('odd', 'even') }}">
          <td><a href="{{ item['jira_url'] }}">{{ item['key'] }}</a></td>
          <td><span class="sev sev-{{ item['severity'] }}">{{ item['severity'] }}</span></td>
          <td><span class="status status-{{ item['status'].replace(' ', '') }}">{{ item['status'] }}</span></td>
          <td><a href="{{ item['report_url'] }}">{{ item['summary'] }}</a></td>
        </tr>
      {% endfor %}
    </table>
    <p>
      <a href="{{ new_incidents_link }}">See these incidents in Jira</a>
    </p>
  {% else %}
    <p>
      There were no incidents.
    </p>
  {% endif %}

  <h1>Active incidents ({{ active_incidents | length }})</h1>
  {% if active_incidents %}
    <table class="incidents">
      <tr>
        <th>Jira</th>
        <th>Severity</th>
        <th>Status</th>
        <th>Summary</th>
      </tr>
      {% for item in active_incidents | sort(attribute="severity") %}
        <tr class="row-{{ loop.cycle('odd', 'even') }}">
          <td><a href="{{ item['jira_url'] }}">{{ item['key'] }}</a></td>
          <td><span class="sev sev-{{ item['severity'] }}">{{ item['severity'] }}</span></td>
          <td><span class="status status-{{ item['status'].replace(' ', '') }}">{{ item['status'] }}</span></td>
          <td><a href="{{ item['report_url'] }}">{{ item['summary'] }}</a></td>
        </tr>
      {% endfor %}
    </table>
    <p>
      <a href="{{ active_incidents_link }}">See these incidents in Jira</a>
    </p>
  {% else %}
    <p>
      There are no active incidents.
    </p>
  {% endif %}

  <p>
    Generated with <code>iim_weekly_overview.py</code> by Incident Program Committee.
  </p>
</body>
</html>
